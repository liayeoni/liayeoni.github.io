---
title: 카이제곱 분포와 검정
description: 
author: Ahyeon Lee
date: 2024-04-10
categories: [통계학]
tags: [statistics]
pin: true
math: true
mermaid: true
---


## 카이 제곱 분포의 이해


> 통계에서 가장 중요하게 보는 것은 데이터의 중심 위치를 파악하는 것이고, 이는 곧 평균을 의미한다. 그리고 평균이 흩어져있는 정도를 분산이라고 한다. 분산의 특징을 확률 분포로 만든 것이 카이제곱 분포이다. 

1) 독립적이고 표준정규 분포를 따르는 확률 변수에서 
2) 샘플 하나를 랜덤추출하고
3) 그 변수를 제곱해서 histogram에 카운트를 시켜보면 다음과 같다.
![](https://velog.velcdn.com/images/liayeoni/post/33f8b425-f878-454d-8ad1-d2c772c239b3/image.png)

이 방식을 무수히 많이 반복한다면 이런 모양의 그래프가 나오게 된다.

![](https://velog.velcdn.com/images/liayeoni/post/667ac712-66b5-4d7d-80be-0067aeb0ab31/image.png)

그렇다면 표준정규분포에서 변수 세 개를 뽑는 경우, 즉 k=3일 경우의 그래프 모양은 다음과 같다.

![](https://velog.velcdn.com/images/liayeoni/post/21a6aac4-db07-4668-9037-58e52358788c/image.png)




자유도가 2 이상일 때 카이제곱 그래프를 보면 다음과 같다.

![](https://velog.velcdn.com/images/liayeoni/post/ca429af5-e99b-46aa-a141-4991e641d347/image.png)


카이제곱 그래프를 보면 0의 오른쪽 부분에 분포가 많고, 0에서 멀어질수록 분포가 감소하는 것을 알 수 있다.  

예를 들어 성인 남자의 평균 키가 173cm라는 것은 174cm와 169cm와 172cm처럼 평균을 기준으로 치우침이 별로 크지 않은 사람들이 많고, 138cm, 140cm나 190cm 210cm처럼 치우침이 매우 큰 사람은 적다. 이처럼 평균에서 치우침이 매우 큰 경우는 없기 때문에 다음과 같은 모양을 확인할 수 있다. 

하지만 0근처의 분포도 적다는 것을 알 수 있는데, 이는 평균과 매우 비슷한 경우를 말한다. 현실적으로 데이터 집단을 조사해보면 어느 정도의 오차는 자연스럽게 발생하기에, 0근처의 분포도 얼마 되지 않는다. 

![](https://velog.velcdn.com/images/liayeoni/post/96297836-90c8-42c9-943a-b84fa77a71fb/image.png)

카이제곱분포는 표본의 수에 따라 그래프의 모양이 달라지는데, 표본의 수가 많아지면 그래프는 넓적한 정규분포 형태가 된다. 카이제곱분포의 특징은 곧 분산의 특징이라고 생각하면 쉽다. 분산이 어느정도 크기인 경우가 많고 분산이 매우 작거나 매우 큰 경우는 별로 없다는 것을 알 수 있다. 

## 카이 제곱 검정이란?
> 카이제곱 검정은 데이터 수집 방법과 가설에 따라 **적합도 검정, 동질성 검정, 독립성 검정** 세 종류가 있다. 

- 두 범주형 변수에 대한 분석 방법이다. 예를 들면 성별에 따른 정당 지지율 비교 문제가 해당된다.

- 관찰된 빈도가 기대되는 빈도와 유의하게 다른지를 검증한다. 

- <span style="background-color:#DCFFE4"> (적합도 검정)</span> 한 범주형 변수의 각 그룹 별 비율과 특정 상수비가 같은지 검정
- <span style="background-color:#DCFFE4"> (동질성 검정)</span> 각 집단이 서로 유사한 성향을 갖는지 분석
- <span style="background-color:#DCFFE4"> (독립성 검정)</span> 두 변수형 변수가 서로 독립인지 검정

1) 적합도 검정 : 변수 수는 1개. 예를 들어 교배 실험으로 얻은 완두콩 비율이 멘델의 법칙 9:3:3:1을 따르는지 검정. 한 범주형 변수와 각 그룹별 비율이 특정  비율과 같은지 검정. 기존에 알려진 기준이 존재하고, 관찰한 집단이 실제 그 비율과 같은지 검정한다.

2) 부모집단(subpopulation)에 대해 열 변수의 분포가 동일한지 검정한다. 예를 들어 성별에 따라 선호하는 음료의 유형이 다른지 검정하는 경우이다. 부모집단 별로 정해진 수만큼의 자료를 조사하여 각 범주별로 비율이 다른지 검정한다. 예를 들어 남자 100명과 여자 300명을 부모집단으로 설정하고,  선호 음료 유형이 서로 동질적인지 비교하는데 이용한다. 

3) 전체 조사 대상을 고정한 뒤, 조사 결과를 바탕으로 두 범주형 변수 간 연관관계가 유의한지 카이제곱 검정을 통해 확인한다. 성별과 전공선택이 서로 관계가 있는지 검정할 경우가 있다.


### 카이 제곱 통계량이란?
---
> 카이 제곱 통계량은 데이터 분포와 가정된 분포 사이의 차이를 나타내는 측정값이다. 

![](https://velog.velcdn.com/images/liayeoni/post/906c133d-0c21-4bf3-ba1c-aa0a48836a07/image.png)

- Oi는 i번째 데이터에 관찰값,  Ei는 i번째 데이터에 대한 기댓값이다. (O−E)^2은 편차의 제곱이고, E로 나누어 정규화를 시켜주었다.

- 카이제곱 검정 통계량이 카이제곱분포를 따른다면 카이제곱분포를 사용해서 가설검정을 수행한다.
- 귀무가설 하에서 검정 통계량이 카이제곱 분포를 따를 때, 검정 통계치가 카이제곱분포에서 일어나기 어려운 일이면 귀무가설 기각, 충분히 일어날 수 있는 일이면 귀무가설을 기각하지 않는다.
- 이 때 일어날 법한 일인지, 희귀한 경우인지의 판단 기준은 confidence level 혹은 p value로 한다.

### 카이 제곱 P-Value?
---
카이 제곱 검정으로 p value를 얻게 된다. 이 때 p value는 검정 결과가 얼마나 유의한가에 대한 지표이다.

카이 제곱 검정을 수행하고, p value를 얻기 위해서는 
1) 자유도 n - 1, 이 때 n은 카테고리 개수 
2) alpha level = 0.05, 0.01 연구자에 의해 결정된다.

![](https://velog.velcdn.com/images/liayeoni/post/285ad812-4a7a-4508-bbc7-5fd31e2f240f/image.png)

### 적합도 검정
> 적합도 검정 ; 기존에 알려진 기준이 존재하고, 관찰한 집단이 실제 그 비율과 같은지 검정

![](https://velog.velcdn.com/images/liayeoni/post/0d3f30f1-062a-45df-b970-09e55027dc8c/image.png)

위와 같은 데이터 셋을 생각해보자. 5개의 맛이 섞여있는 사탕 주머니에서 100번을 집었을 때 관측값이다. 다섯 개의 사탕이 골고루 들어있을 것이라고 생각하였으므로 기댓값은 50이 된다. 위의 식에 대입하여 보면, 

$\chi^2 = \frac{(17-20)^2}{20}+\frac{(16-20)^2}{20}+\frac{(24-20)^2}{20}+\frac{(29-20)^2}{20}+\frac{(14-20)^2}{20} = 7.9$ 와 같다. 
총 5개의 변수가 있기 때문에 자유도는 4가 되고, 자유도가 4일 때 p-value 0.05에 해당하는 카이제곱 값은 아래와 같다.

$\chi^2(4)_{0.95} = 9.4877$ 

 통계량은 카이제곱 값보다 작으므로 따라서 5가지 종류가 다른 비율로 섞여있다고 보기는 어렵고, 우연히 발생한 오차라고 결론지을 수 있다.

### 동질성 검정(교차분석)
> 범주형 변수가 여러 개인 경우 적용하는 분석 방법이다. 교차 분석의 목적은 여러 범주형 변수의 범주 간 차이가 기댓값에서 유의하게 벗어나는지 확인하는 것이다. 

![](https://velog.velcdn.com/images/liayeoni/post/088af045-f953-4969-b354-79783fd046d9/image.png)


$\text{기댓값} = \frac{\text{해당 행 전체 합}\times\text{해당 열 전체 합}}{\text{전체 데이터 수}}$

![](https://velog.velcdn.com/images/liayeoni/post/1c0c735f-5dfb-479e-9937-b04727f33c21/image.png)

![](https://velog.velcdn.com/images/liayeoni/post/925957ba-5f38-4fa8-a539-5469446033ee/image.png)

교차 분석 시 행 갯수를 $r$, 열 갯수를 $c$라고 했을 때 자유도는 
$(r-1)\times (c-1)$ 로 계산한다. 
  
  관측 빈도와 기대 빈도는 위와 같다. 각 메뉴별로 성별 간 선택의 차이를 보이는지, 혹은 각 성별 별로 메뉴 선택의 차이를 보이는지 알아보는 것이 목적이다. 

통계량 계산 : 

$ \chi^2 = \frac{(21-17.41)^2}{17.41} + \frac{(16-19.59)^2}{19.59} + 
  \frac{(13-13.18)^2}{13.18} \notag$ 

자유도는 (2 - 1) x (3 - 1) = 2이다.
상위 95%에 해당하는  $\chi^2$ 값은 다음과 같다. 

$\chi^2(2)_{0.95} = 5.9915$

결론 : 우리가 구한 통계량은 $\chi^2$ 보다 작다. 성별 및 메뉴판에 대해 기댓값에서 유의하게 벗어나지 않는다. 

### 독립성 검정 예시
독립성 검정의 목표 : 내가 설정한 독립변수(원인)가 종속변수(결과)에 정말 영향을 미치는지 아니면 독립적인지 알아보기 위함.

귀무가설 : 독립변수는 종속변수와 상호 독립적이다.
대립가설 : 독립변수는 종속변수와 독립적이지 않다.
따라서 검정 통계량 P-value가 0.05이하로 나와야 원하는 결과를 확인할 수 있다.

### 가족구성원수와 SUV소유 여부는 독립적이다.

![](https://velog.velcdn.com/images/liayeoni/post/c13647bc-2b6f-4cfa-8003-cde0a9996a21/image.png)

- 두 변수가 독립이라는 가정하에 
> **P(3명이하 ∩ SUV 소유) * 전체 샘플 수** 
= P(3명 이하) * P(SUV 소유) * 전체 샘플 수

최종 검정 카이제곱 계수는 42.9이고, 카이제곱 검정분포표에 따라 유의 수준이 1%이면 임계점이 9.21로 계산된다. 
42.9 > 9.21이기 때문에 귀무가설을 기각하고, 대립가설을 채택한다.
결론적으로, 가족 구성원 수는 SUV 소유 여부에 충분히 영향을 주는 변수라고 해석할 수 있다.
